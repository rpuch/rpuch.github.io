---
layout: post
title: Clean, safe and concise read-only Wicket Model with Java 8 Lambdas
date: '2014-11-26T21:42:00.000+03:00'
author: rpuchkovskiy
tags:
- Java 8
- method reference
- type-safe
- concise
- Wicket model
- lambda
modified_time: '2014-11-26T21:42:23.901+03:00'
blogger_id: tag:blogger.com,1999:blog-4160252863216482620.post-8700908848124778459
blogger_orig_url: https://rpuchkovskiy.blogspot.com/2014/11/clean-safe-and-concise-read-only-wicket.html
---

<p><a href="http://wicket.apache.org/" target="_blank">Wicket framework</a> uses models (<a href="https://wicket.apache.org/apidocs/1.4/org/apache/wicket/model/IModel.html" target="_blank">IModel</a> implementations) to bind data to components. Let's say you want to display properties of some object. Here is the data class: </p> <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">User</span> <span style="color: #008800; font-weight: bold">implements</span> Serializable <span style="color: #333333">{</span><br />    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">final</span> String name<span style="color: #333333">;</span><br />    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> age<span style="color: #333333">;</span><br /><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">User</span><span style="color: #333333">(</span>String name<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> age<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">name</span> <span style="color: #333333">=</span> name<span style="color: #333333">;</span><br />        <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">age</span> <span style="color: #333333">=</span> age<span style="color: #333333">;</span><br />    <span style="color: #333333">}</span><br /><br />    <span style="color: #008800; font-weight: bold">public</span> String <span style="color: #0066BB; font-weight: bold">getName</span><span style="color: #333333">()</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">return</span> name<span style="color: #333333">;</span><br />    <span style="color: #333333">}</span><br /><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">getAge</span><span style="color: #333333">()</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">return</span> age<span style="color: #333333">;</span><br />    <span style="color: #333333">}</span><br /><span style="color: #333333">}</span><br /></pre></td></tr></table></div> <p>You can do the following to display both its properties using Label components: </p> <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">AbstractReadOnlyModelPanel</span> <span style="color: #008800; font-weight: bold">extends</span> Panel <span style="color: #333333">{</span><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">AbstractReadOnlyModelPanel</span><span style="color: #333333">(</span>String id<span style="color: #333333">,</span> IModel<span style="color: #333333">&lt;</span>User<span style="color: #333333">&gt;</span> model<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">(</span>id<span style="color: #333333">,</span> model<span style="color: #333333">);</span><br /><br />        add<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Label<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;name&quot;</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">new</span> AbstractReadOnlyModel<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;()</span> <span style="color: #333333">{</span><br />            <span style="color: #555555; font-weight: bold">@Override</span><br />            <span style="color: #008800; font-weight: bold">public</span> String <span style="color: #0066BB; font-weight: bold">getObject</span><span style="color: #333333">()</span> <span style="color: #333333">{</span><br />                <span style="color: #008800; font-weight: bold">return</span> model<span style="color: #333333">.</span><span style="color: #0000CC">getObject</span><span style="color: #333333">().</span><span style="color: #0000CC">getName</span><span style="color: #333333">();</span><br />            <span style="color: #333333">}</span><br />        <span style="color: #333333">}));</span><br />        add<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Label<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;age&quot;</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">new</span> AbstractReadOnlyModel<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;()</span> <span style="color: #333333">{</span><br />            <span style="color: #555555; font-weight: bold">@Override</span><br />            <span style="color: #008800; font-weight: bold">public</span> Integer <span style="color: #0066BB; font-weight: bold">getObject</span><span style="color: #333333">()</span> <span style="color: #333333">{</span><br />                <span style="color: #008800; font-weight: bold">return</span> model<span style="color: #333333">.</span><span style="color: #0000CC">getObject</span><span style="color: #333333">().</span><span style="color: #0000CC">getAge</span><span style="color: #333333">();</span><br />            <span style="color: #333333">}</span><br />        <span style="color: #333333">}));</span><br />    <span style="color: #333333">}</span><br /><span style="color: #333333">}</span><br /></pre></td></tr></table></div> <p>Straight-forward, type-safe, but not too concise: each label requires 6 lines of code! Of course, we can reduce this count using some optimized coding conventions and so on, but anyway, anonymous classes are very verbose. </p> <p>A more economical way (in terms of lines and characters to type and read) is <a href="https://wicket.apache.org/apidocs/1.4/org/apache/wicket/model/PropertyModel.html" target="_blank">PropertyModel</a>. </p> <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">PropertyModelPanel</span> <span style="color: #008800; font-weight: bold">extends</span> Panel <span style="color: #333333">{</span><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">PropertyModelPanel</span><span style="color: #333333">(</span>String id<span style="color: #333333">,</span> IModel<span style="color: #333333">&lt;</span>User<span style="color: #333333">&gt;</span> model<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">(</span>id<span style="color: #333333">,</span> model<span style="color: #333333">);</span><br /><br />        add<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Label<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;name&quot;</span><span style="color: #333333">,</span> PropertyModel<span style="color: #333333">.</span><span style="color: #0000CC">of</span><span style="color: #333333">(</span>model<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;name&quot;</span><span style="color: #333333">)));</span><br />        add<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Label<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;age&quot;</span><span style="color: #333333">,</span> PropertyModel<span style="color: #333333">.</span><span style="color: #0000CC">of</span><span style="color: #333333">(</span>model<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;age&quot;</span><span style="color: #333333">)));</span><br />    <span style="color: #333333">}</span><br /><span style="color: #333333">}</span><br /></pre></td></tr></table></div> <p>It is way shorter and still pretty intuitive. But it has drawbacks: <ul><li>First of all, it is not safe as the compiler does not check whether property named "age" exists at all! </li><li>And it uses reflection which does not make your web-application faster. This does not seem to be critical, but it is still a little drawback. </li></ul></p><p>Luckily, Java 8 introduced <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html" target="_blank">lambdas</a> and <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html" target="_blank">method references</a> which allow us to create another model implementation. Here it is: </p> <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">GetterModel</span><span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> <span style="color: #008800; font-weight: bold">extends</span> AbstractReadOnlyModel<span style="color: #333333">&lt;</span>P<span style="color: #333333">&gt;</span> <span style="color: #333333">{</span><br />    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">final</span> E entity<span style="color: #333333">;</span><br />    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">final</span> IModel<span style="color: #333333">&lt;</span>E<span style="color: #333333">&gt;</span> entityModel<span style="color: #333333">;</span><br />    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">final</span> IPropertyGetter<span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> getter<span style="color: #333333">;</span><br /><br />    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #0066BB; font-weight: bold">GetterModel</span><span style="color: #333333">(</span>E entity<span style="color: #333333">,</span> IModel<span style="color: #333333">&lt;</span>E<span style="color: #333333">&gt;</span> entityModel<span style="color: #333333">,</span> IPropertyGetter<span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> getter<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">entity</span> <span style="color: #333333">=</span> entity<span style="color: #333333">;</span><br />        <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">entityModel</span> <span style="color: #333333">=</span> entityModel<span style="color: #333333">;</span><br />        <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">getter</span> <span style="color: #333333">=</span> getter<span style="color: #333333">;</span><br />    <span style="color: #333333">}</span><br /><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> GetterModel<span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> ofObject<span style="color: #333333">(</span>E entity<span style="color: #333333">,</span> IPropertyGetter<span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> getter<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        Objects<span style="color: #333333">.</span><span style="color: #0000CC">requireNonNull</span><span style="color: #333333">(</span>entity<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Entity cannot be null&quot;</span><span style="color: #333333">);</span><br />        Objects<span style="color: #333333">.</span><span style="color: #0000CC">requireNonNull</span><span style="color: #333333">(</span>getter<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Getter cannot be null&quot;</span><span style="color: #333333">);</span><br /><br />        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">new</span> GetterModel<span style="color: #333333">&lt;&gt;(</span>entity<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> getter<span style="color: #333333">);</span><br />    <span style="color: #333333">}</span><br /><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> GetterModel<span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> ofModel<span style="color: #333333">(</span>IModel<span style="color: #333333">&lt;</span>E<span style="color: #333333">&gt;</span> entityModel<span style="color: #333333">,</span> IPropertyGetter<span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> getter<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        Objects<span style="color: #333333">.</span><span style="color: #0000CC">requireNonNull</span><span style="color: #333333">(</span>entityModel<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Entity model cannot be null&quot;</span><span style="color: #333333">);</span><br />        Objects<span style="color: #333333">.</span><span style="color: #0000CC">requireNonNull</span><span style="color: #333333">(</span>getter<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Getter cannot be null&quot;</span><span style="color: #333333">);</span><br /><br />        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">new</span> GetterModel<span style="color: #333333">&lt;&gt;(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> entityModel<span style="color: #333333">,</span> getter<span style="color: #333333">);</span><br />    <span style="color: #333333">}</span><br /><br />    <span style="color: #555555; font-weight: bold">@Override</span><br />    <span style="color: #008800; font-weight: bold">public</span> P <span style="color: #0066BB; font-weight: bold">getObject</span><span style="color: #333333">()</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">return</span> getter<span style="color: #333333">.</span><span style="color: #0000CC">getPropertyValue</span><span style="color: #333333">(</span>getEntity<span style="color: #333333">());</span><br />    <span style="color: #333333">}</span><br /><br />    <span style="color: #008800; font-weight: bold">private</span> E <span style="color: #0066BB; font-weight: bold">getEntity</span><span style="color: #333333">()</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">return</span> entityModel <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">?</span> entityModel<span style="color: #333333">.</span><span style="color: #0000CC">getObject</span><span style="color: #333333">()</span> <span style="color: #333333">:</span> entity<span style="color: #333333">;</span><br />    <span style="color: #333333">}</span><br /><span style="color: #333333">}</span><br /></pre></td></tr></table></div> <p>... along with its support interface:</p> <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1<br />2<br />3</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">interface</span> <span style="color: #BB0066; font-weight: bold">IPropertyGetter</span><span style="color: #333333">&lt;</span>E<span style="color: #333333">,</span> P<span style="color: #333333">&gt;</span> <span style="color: #333333">{</span><br />    P <span style="color: #0066BB; font-weight: bold">getPropertyValue</span><span style="color: #333333">(</span>E entity<span style="color: #333333">);</span><br /><span style="color: #333333">}</span><br /></pre></td></tr></table></div> <p>And here is the same panel example rewritten using the new model class:</p> <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">GetterModelPanel</span> <span style="color: #008800; font-weight: bold">extends</span> Panel <span style="color: #333333">{</span><br />    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">GetterModelPanel</span><span style="color: #333333">(</span>String id<span style="color: #333333">,</span> IModel<span style="color: #333333">&lt;</span>User<span style="color: #333333">&gt;</span> model<span style="color: #333333">)</span> <span style="color: #333333">{</span><br />        <span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">(</span>id<span style="color: #333333">,</span> model<span style="color: #333333">);</span><br /><br />        add<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Label<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;name&quot;</span><span style="color: #333333">,</span> GetterModel<span style="color: #333333">.</span><span style="color: #0000CC">ofModel</span><span style="color: #333333">(</span>model<span style="color: #333333">,</span> <span style="color: #997700; font-weight: bold">User:</span><span style="color: #333333">:</span>getName<span style="color: #333333">)));</span><br />        add<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Label<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;age&quot;</span><span style="color: #333333">,</span> GetterModel<span style="color: #333333">.</span><span style="color: #0000CC">ofModel</span><span style="color: #333333">(</span>model<span style="color: #333333">,</span> <span style="color: #997700; font-weight: bold">User:</span><span style="color: #333333">:</span>getAge<span style="color: #333333">)));</span><br />    <span style="color: #333333">}</span><br /><span style="color: #333333">}</span><br /></pre></td></tr></table></div> <p>The code is almost as concise as the version using PropertyModel, but it is: <ul><li>type-safe: the compiler will check the actual getter type </li><li>defends you from typos better, because compiler will check that the getter actually exists </li><li>fast as it just uses regular method calls (2 per <code>getObject()</code> call in this case) instead of parsing property expression and using reflection </li></ul></p> <p>Here are the drawbacks of the described approach in comparison with PropertyModel: <ul><li>It's read-only while PropertyModel allows to write to the property. It's easy to add ability to write using setter, but it will make code pretty clumsy, and we'll have to be careful and not use getter from one property and setter from another one. </li><li>PropertyModel allows to reference nested properties using the dot operator, for instance using "outerObject.itsProperty.propertyOfProperty" property expression. </li></ul></p> <p>But anyway, when you just need read-only models, GetterModel seems to be an interesting alternative to the PropertyModel. </p> <p>And here is a little bonus: this model implementation allows to use both models and plain data objects as sources. We just need two factory methods: <code>ofModel()</code> and <code>ofObject()</code>, and we mimic the magical universality of PropertyModel (which accepts both models and POJOs as first argument) with no magic tricks at all. </p>